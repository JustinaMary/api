name: 'Bump Minor Version'

on:
    push:
        branches:
            - 'master'

jobs:
    bump-version:
        runs-on: ubuntu-latest

        steps:
            - name: 'Checkout source code'
              uses: 'actions/checkout@v2'
              with:
                  ref: ${{ github.ref }}
                  token: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: 'Setup Node.js'
              uses: 'actions/setup-node@v1'
              with:
                  node-version: 10
            - name: 'Bump Minor Version'
              if: github.actor != 'Version Bot'
              run: |
                  git config --global user.email "version.bot@thx.network"
                  git config --global user.name "Version Bot"
                  npm version minor
                  VERSION=`cat package.json | grep 'version' | sed 's/[^0-9\.]//g'`
                  git tag $VERSION
                  git push
              env:
                  GITHUB_TOKEN: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: 'Version Bumped'
              run: cat ./package.json | grep "version"
