name: 'Bump Patch Version'

on:
    push:
        branches:
            - 'develop'

jobs:
    bump-version:
        runs-on: ubuntu-latest

        steps:
            - name: 'Checkout source code'
              uses: 'actions/checkout@v2'
              with:
                  ref: ${{ github.ref }}
            - name: 'Setup Node.js'
              uses: 'actions/setup-node@v1'
              with:
                  node-version: 10
            - name: 'Bump Patch Version'
              run: |
                  npm version patch
                  VERSION=`cat package.json | grep 'version' | sed 's/[^0-9\.]//g'`
                  git tag $VERSION
              env:
                  GITHUB_TOKEN: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: Create Pull Request
              uses: peter-evans/create-pull-request@v3
              with:
                  token: ${{ secrets.VERSION_BUMP_TOKEN }}
                  commit-message: Update report
                  committer: GitHub <noreply@github.com>
                  author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
                  signoff: false
                  branch: release/$VERSION
                  delete-branch: true
                  title: Bump Version $VERSION
                  body: Patches package version to $VERSION
              env:
                  GITHUB_TOKEN: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: 'New Version'
              run: cat ./package.json | grep "version"
