name: 'Bump Patch Version'

on:
    push:
        branches:
            - 'develop'

jobs:
    bump-version:
        runs-on: ubuntu-latest

        steps:
            - name: 'Checkout source code'
              uses: 'actions/checkout@v2'
              with:
                  ref: ${{ github.ref }}
            - name: 'Setup Node.js'
              uses: 'actions/setup-node@v1'
              with:
                  node-version: 10
            - name: 'Bump Patch Version'
              run: |
                  git config --global user.email "version.bot@thx.network"
                  git config --global user.name "ðŸ¤– Version Bot"
                  npm version patch
                  VERSION=`cat package.json | grep 'version' | sed 's/[^0-9\.]//g'`
                  git tag $VERSION
                  git checkout -b release/$VERSION
                  git push origin release/$VERSION
              env:
                  GITHUB_TOKEN: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: Create Pull Request
              uses: peter-evans/create-pull-request@v3
              with:
                  title: Bump Version $VERSION
                  body: Patches package version to $VERSION
                  branch: release/$VERSION
                  delete-branch: true
              env:
                  GITHUB_TOKEN: ${{ secrets.VERSION_BUMP_TOKEN }}
            - name: 'cat package.json'
              run: cat ./package.json | grep "version"
