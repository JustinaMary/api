<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <meta charset="UTF-8">
    <title>THX | Identity Provider</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body class="d-flex w-100 h-100 bg-light align-items-center justify-content-center">
    <main class="card card-white">
        <div class="card-body">
            <% if (client.logoUri) { %><img src="<%= client.logoUri %>"><% } %>
        
            <ul>
            <% if ([details.scopes.accepted, details.scopes.rejected, details.claims.accepted, details.claims.rejected].every(({ length }) => length === 0)) { %>
                <li>this is a new authorization</li>
            <% } %>
            
            <% if ([details.scopes.new, details.claims.new].every(({ length }) => length === 0)) { %>
                <li>the client is asking you to confirm previously given authorization</li>
            <% } %>
            
            <% newScopes = new Set(details.scopes.new); newScopes.delete('openid'); newScopes.delete('offline_access') %>
            <% if (newScopes.size) { %>
                <li>scopes:</li>
                <ul>
                <% newScopes.forEach((scope) => { %>
                    <li><%= scope %></li>
                <% }) %>
                </ul>
            <% } %>
            
            <% newClaims = new Set(details.claims.new); ['sub', 'sid', 'auth_time', 'acr', 'amr', 'iss'].forEach(Set.prototype.delete.bind(newClaims)) %>
            <% if (newClaims.size) { %>
                <li>claims:</li>
                <ul>
                <% newClaims.forEach((claim) => { %>
                    <li><%= claim %></li>
                <% }) %>
                </ul>
            <% } %>
            
            <% if (params.scope && params.scope.includes('offline_access')) { %>
                <li>
                the client is asking to have offline access to this authorization
                <% if (!details.scopes.new.includes('offline_access')) { %>
                    (which you've previously granted)
                <% } %>
                </li>
            <% } %>
            </ul>
            <form autocomplete="off" action="/interaction/<%= uid %>/confirm" method="post">
                <button autofocus type="submit" class="btn btn-block btn-primary">Continue</button>
            </form>            
        </div>
    </main>
</body>

</html>